<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAI Stone Tools</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Arial,Helvetica,sans-serif;background:#f4f4f4;color:#333;min-height:100vh;display:flex;flex-direction:column}
nav{background:#fff;box-shadow:0 2px 4px rgba(0,0,0,.1);padding:10px 20px;display:flex;justify-content:space-between;align-items:center}
nav .brand{font-size:1.2rem;font-weight:700;color:#007bff}
.hidden{display:none}

h1,h2{color:#007bff;text-align:center;margin:20px 0}
section{padding:20px;width:100%;flex:1;display:flex;flex-direction:column;align-items:center}
.card-container{display:flex;gap:20px;flex-wrap:wrap;justify-content:center;margin-top:40px}
.card{background:#fff;border:1px solid #ddd;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1);padding:40px 60px;cursor:pointer;transition:transform .2s;font-size:1.1rem;text-align:center}
.card:hover{transform:translateY(-4px)}
button.primary{margin-top:20px;background:#007bff;color:#fff;border:none;padding:10px 16px;border-radius:5px;cursor:pointer;transition:background .2s}
button.primary:hover{background:#0056b3}
.back-btn{margin-top:20px;background:#6c757d}

a.download-link{margin-top:15px;display:inline-block;text-decoration:none;color:#007bff}
a.download-link:hover{text-decoration:underline}

/* Forms & outputs */
form{background:#fff;width:100%;max-width:600px;padding:20px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1)}
form label{display:block;margin-top:15px;font-weight:700}
form input[type=text],form input[type=number],form select,form textarea{width:100%;padding:8px;margin-top:5px;border-radius:4px;border:1px solid #ccc}
textarea{resize:vertical;min-height:60px;font-family:monospace}
details{margin-top:20px;border:1px solid #ccc;border-radius:8px;padding:10px;background:#fafafa}
summary{cursor:pointer;font-weight:700}
.output{margin-top:20px;background:#fff;width:100%;max-width:600px;padding:20px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1);font-size:1rem}
.output span{display:block;margin-bottom:6px}
.output table{width:100%;border-collapse:collapse;margin-top:10px;font-size:.9rem}
.output th,.output td{border:1px solid #ddd;padding:6px;text-align:center}

iframe{border:none;width:100%;max-width:1200px;height:800px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1)}

/* Pattern sub-tabs */
.pattern-tabs{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
.tab-btn{padding:8px 14px;border:1px solid #007bff;border-radius:6px;background:#fff;color:#007bff;cursor:pointer;transition:.2s}
.tab-btn.active,.tab-btn:hover{background:#007bff;color:#fff}
</style>
</head>
<body>
<nav><div class="brand">SAI Stone Tools</div></nav>

<!-- HOME SECTION -->
<section id="home-section">
  <h1>Choose Your Tool</h1>
  <div class="card-container">
    <div class="card" id="open-signature">‚úâÔ∏è Email Signature Generator</div>
    <div class="card" id="open-waterjet">üíß Water Jet Pricing Calculator</div>
    <div class="card" id="open-pattern">üìê Pattern Calculator</div>
  </div>
</section>

<!-- EMAIL SIGNATURE SECTION (unchanged) -->
<section id="signature-section" class="hidden">
  <h2>Email Signature Generator</h2>
  <iframe src="email_signature.html" title="Email Signature Generator"></iframe>
  <button class="primary back-btn" id="back-from-signature">‚¨Ö Back to Home</button>
</section>

<!-- WATERJET SECTION (unchanged; omitted for brevity) -->
<section id="waterjet-section" class="hidden"><!-- ... existing waterjet markup stays the same ... --></section>

<!-- PATTERN CALCULATOR SECTION -->
<section id="pattern-section" class="hidden">
  <h2>Pattern Calculator</h2>
  <div class="pattern-tabs" id="pattern-tabs">
    <button class="tab-btn active" data-pattern="900">900 Series</button>
    <button class="tab-btn" data-pattern="600">600 Series</button>
    <button class="tab-btn" data-pattern="antline">Antline Pattern</button>
    <button class="tab-btn" data-pattern="brick">Brick Pattern</button>
  </div>
  <a href="pattern-installation-guide.pdf" class="download-link" target="_blank">üìÑ Installation Guide (PDF)</a>
  <form id="pattern-form">
    <label for="area-input">Required Area (m¬≤)</label>
    <input type="number" id="area-input" min="0" step="0.1" placeholder="e.g. 50">
    <details>
      <summary>Admin Settings (pattern-specific)</summary>
      <label for="sqm-per-set">Sqm per Set</label>
      <input type="number" id="sqm-per-set" step="0.001" value="3.1803">
      <label for="component-config">Component Breakdown (one per line: size_mmXmm,pcs-per-set)</label>
      <textarea id="component-config" placeholder="595x595,4\n895x595,2\n595x295,2\n295x295,4"></textarea>
    </details>
    <button type="submit" class="primary">Calculate Pattern</button>
  </form>
  <div id="pattern-output" class="output hidden"></div>
  <button id="download-csv" class="primary hidden">Download CSV</button>
  <button class="primary back-btn" id="back-from-pattern">‚¨Ö Back to Home</button>
</section>

<script>
(function(){
  /* === Navigation === */
  const $=id=>document.getElementById(id);
  const home=$('home-section');const sig=$('signature-section');const jet=$('waterjet-section');const pat=$('pattern-section');
  $('open-signature').onclick=()=>{home.classList.add('hidden');sig.classList.remove('hidden');};
  $('open-waterjet').onclick =()=>{home.classList.add('hidden');jet.classList.remove('hidden');};
  $('open-pattern').onclick  =()=>{home.classList.add('hidden');pat.classList.remove('hidden');};
  $('back-from-signature').onclick=()=>{sig.classList.add('hidden');home.classList.remove('hidden');};
  $('back-from-pattern').onclick  =()=>{pat.classList.add('hidden');home.classList.remove('hidden');};
  $('back-from-waterjet')&&($('back-from-waterjet').onclick=()=>{jet.classList.add('hidden');home.classList.remove('hidden');});

  /* === Pattern Calculator === */
  const tabBtns=[...document.querySelectorAll('.tab-btn')];
  const areaInput=$('area-input');
  const sqmPerSetEl=$('sqm-per-set');
  const compConfigEl=$('component-config');
  const pForm=$('pattern-form');
  const pOutput=$('pattern-output');
  const dlBtn=$('download-csv');

  const patternDefaults={
    '900':{sqm:3.1803,components:'595x595,4\n895x595,2\n595x295,2\n295x295,4'},
    '600':{sqm:2.16,components:'600x600,2\n300x600,4\n300x300,4'},
    'antline':{sqm:1.0,components:'300x75,38'},
    'brick':{sqm:0.461,components:'230x76,55'}
  };
  let currentPattern='900';
  function loadPattern(p){
    currentPattern=p;
    tabBtns.forEach(btn=>btn.classList.toggle('active',btn.dataset.pattern===p));
    sqmPerSetEl.value=patternDefaults[p].sqm;
    compConfigEl.value=patternDefaults[p].components;
    pOutput.classList.add('hidden');
    dlBtn.classList.add('hidden');
  }
  tabBtns.forEach(btn=>btn.addEventListener('click',()=>loadPattern(btn.dataset.pattern)));
  loadPattern('900');

  function parseComponents(str){
    return str.split(/\n+/).map(line=>line.trim()).filter(Boolean).map(line=>{
      const [size,pcs]=line.split(',');
      const [l,w]=size.toLowerCase().split('x').map(n=>parseFloat(n));
      const areaEach=(l*w)/1_000_000; // m¬≤
      return {size:size.trim(),pcsPerSet:parseFloat(pcs),areaEach};
    });
  }

  pForm.addEventListener('submit',e=>{
    e.preventDefault();
    const requestedArea=parseFloat(areaInput.value)||0;
    if(!requestedArea){alert('Please enter area');return;}
    const sqmPerSet=parseFloat(sqmPerSetEl.value)||1;
    const components=parseComponents(compConfigEl.value);
    const setFraction=requestedArea/sqmPerSet; // ‰∏çÂèñÊï¥ÔºÅ

    // ËÆ°ÁÆóÊØèÁßçÁ†ñÁöÑÁâáÊï∞ÔºàÂêë‰∏äÂèñÊï¥Âà∞Êï¥Êï∞ÔºâÔºåÂÜçÁªüËÆ°ÊÄªË¶ÜÁõñÈù¢ÁßØ
    let csv='Size,Qty\n';
    let rows='';
    let coverage=0;
    components.forEach(c=>{
      const rawQty=c.pcsPerSet*setFraction;
      const qty=Math.ceil(rawQty);
      coverage+=qty*c.areaEach;
      csv+=`${c.size},${qty}\n`;
      rows+=`<tr><td>${c.size}</td><td>${qty}</td></tr>`;
    });

    const surplus=coverage-requestedArea;
    pOutput.innerHTML=`<span><strong>Total Coverage:</strong> ${coverage.toFixed(3)} m¬≤</span>
      <span><strong>Requested Area:</strong> ${requestedArea.toFixed(3)} m¬≤</span>
      <span><strong>Surplus / Wastage:</strong> ${surplus.toFixed(3)} m¬≤</span>
      <details style="margin-top:10px"><summary>Component Breakdown</summary>
        <table><thead><tr><th>Size</th><th>Qty</th></tr></thead><tbody>${rows}</tbody></table>
      </details>`;
    pOutput.classList.remove('hidden');

    // download csv
    const blob=new Blob([csv],{type:'text/csv'});
    const url=URL.createObjectURL(blob);
    dlBtn.onclick=()=>{const a=document.createElement('a');a.href=url;a.download=`${currentPattern}-pattern.csv`;a.click();setTimeout(()=>URL.revokeObjectURL(url),1000);};
    dlBtn.classList.remove('hidden');
  });
})();
</script>
</body>
</html>
