<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waterjet Quote Wizard</title>
    <style>
        :root {
            --primary: #2563eb;
            --surface: #ffffff;
            --bg: #f1f5f9;
            --text: #1e293b;
            --border: #e2e8f0;
        }
        * { box-sizing: border-box; font-family: -apple-system, sans-serif; }
        body { background: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; margin: 0; }

        /* Top Bar */
        .top-bar { background: var(--surface); padding: 1rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .home-link { text-decoration: none; color: #64748b; font-weight: 600; font-size: 0.9rem; }
        .admin-trigger { background: none; border: none; font-size: 1.2rem; cursor: pointer; opacity: 0.3; }

        /* Progress Bar */
        .progress-container { width: 100%; height: 6px; background: #cbd5e1; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.4s ease; }

        /* Main Container */
        .wizard-container { 
            flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; 
            padding: 20px; max-width: 600px; margin: 0 auto; width: 100%;
        }

        /* Steps */
        .step { display: none; width: 100%; animation: fadeIn 0.4s; }
        .step.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h1 { font-size: 1.5rem; text-align: center; margin-bottom: 1.5rem; color: var(--text); }
        p.subtitle { text-align: center; color: #64748b; margin-bottom: 2rem; margin-top: -10px; }

        /* Big Choice Buttons */
        .choice-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .choice-card {
            background: var(--surface); border: 2px solid var(--border); border-radius: 12px;
            padding: 20px; text-align: center; cursor: pointer; transition: 0.2s;
            display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 120px;
        }
        .choice-card:hover { border-color: var(--primary); transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .choice-card .icon { font-size: 2.5rem; margin-bottom: 10px; }
        .choice-card .label { font-weight: 600; font-size: 1.1rem; }

        /* Inputs */
        .input-wrapper { background: var(--surface); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        label { display: block; margin-bottom: 8px; font-weight: 600; }
        input[type="number"] { width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 1.2rem; margin-bottom: 15px; }
        
        /* Navigation Buttons */
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 30px; }
        .btn { padding: 12px 24px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; font-size: 1rem; }
        .btn-back { background: #cbd5e1; color: #475569; }
        .btn-next { background: var(--primary); color: white; width: 100%; margin-left: 10px; }

        /* Result Page */
        .result-card { background: var(--surface); padding: 30px; border-radius: 16px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); text-align: center; width: 100%; }
        .final-price { font-size: 3.5rem; font-weight: 800; color: var(--primary); margin: 10px 0; }
        .summary-list { text-align: left; background: #f8fafc; padding: 15px; border-radius: 8px; margin: 20px 0; font-size: 0.9rem; color: #475569; }
        .summary-list div { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px dashed #cbd5e1; }

        /* Admin Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center; }
        .modal.open { display: flex; }
        .modal-content { background: white; padding: 20px; border-radius: 8px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; }
        .form-row { display: flex; justify-content: space-between; margin-bottom: 10px; align-items: center; }
        .form-row input { width: 80px; padding: 5px; }
    </style>
</head>
<body>

    <div class="top-bar">
        <a href="index.html" class="home-link">‚¨Ö Back to Dashboard</a>
        <button class="admin-trigger" onclick="toggleAdmin()">‚öôÔ∏è</button>
    </div>
    
    <div class="progress-container">
        <div class="progress-fill" id="progressBar"></div>
    </div>

    <div class="wizard-container">
        
        <div class="step active" id="step1">
            <h1>What is the material?</h1>
            <p class="subtitle">Step 1 of 4</p>
            <div class="choice-grid" id="materialGrid">
                </div>
        </div>

        <div class="step" id="step2">
            <h1>How thick is it?</h1>
            <p class="subtitle">Step 2 of 4</p>
            <div class="choice-grid" id="thicknessGrid">
                </div>
            <div class="nav-buttons">
                <button class="btn btn-back" onclick="changeStep(-1)">Back</button>
            </div>
        </div>

        <div class="step" id="step3">
            <h1>What are we cutting?</h1>
            <p class="subtitle">Step 3 of 4</p>
            <div class="choice-grid">
                <div class="choice-card" onclick="selectType('linear')">
                    <span class="icon">üìè</span>
                    <span class="label">Linear Cut<br><small>(Meters)</small></span>
                </div>
                <div class="choice-card" onclick="selectType('cutout')">
                    <span class="icon">üï≥Ô∏è</span>
                    <span class="label">Hole / Cut-out<br><small>(Sinks, Taps)</small></span>
                </div>
                <div class="choice-card" onclick="selectType('artistic')">
                    <span class="icon">üé®</span>
                    <span class="label">Artistic<br><small>(Logos, Patterns)</small></span>
                </div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-back" onclick="changeStep(-1)">Back</button>
            </div>
        </div>

        <div class="step" id="step4">
            <h1 id="dimTitle">Enter Details</h1>
            <p class="subtitle">Step 4 of 4</p>
            
            <div class="input-wrapper">
                <div id="input-container"></div>
                
                <hr style="border: 0; border-top: 1px solid #e2e8f0; margin: 20px 0;">
                
                <label>Add-ons</label>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <label style="font-weight: normal; display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="opt-cad" style="width:auto; margin:0;"> 
                        No CAD File (Add Drafting Fee)
                    </label>
                    <label style="font-weight: normal; display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="opt-polish" style="width:auto; margin:0;"> 
                        Edge Polishing Needed
                    </label>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-back" onclick="changeStep(-1)">Back</button>
                <button class="btn btn-next" onclick="calculateFinal()">Calculate Price</button>
            </div>
        </div>

        <div class="step" id="step5">
            <div class="result-card">
                <h2>Total Estimate</h2>
                <div class="final-price" id="priceDisplay">$0.00</div>
                <div class="summary-list" id="summaryText">
                    </div>
                <button class="btn btn-next" onclick="location.reload()">Start New Quote üîÑ</button>
            </div>
        </div>

    </div>

    <div class="modal" id="adminModal">
        <div class="modal-content">
            <h2>‚öôÔ∏è Base Rates</h2>
            <div id="adminForm"></div>
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn btn-back" onclick="toggleAdmin()">Cancel</button>
                <button class="btn btn-next" style="width: auto;" onclick="saveConfig()">Save</button>
            </div>
        </div>
    </div>

<script>
    // --- CONFIGURATION (Saved in LocalStorage) ---
    const defaultConfig = {
        rates: { linear: 45, cutout: 60, artistic: 400 },
        fees: { drafting: 80, polish: 25 },
        materials: [
            { name: "Soft (Limestone)", val: 1.0, icon: "üß±" },
            { name: "Hard (Granite)", val: 1.3, icon: "ü™®" },
            { name: "Ultra (Quartzite)", val: 1.6, icon: "üíé" }
        ],
        thickness: [
            { name: "< 20mm", val: 1.0 },
            { name: "30-40mm", val: 1.5 },
            { name: "50mm+", val: 2.0 }
        ]
    };

    let config = JSON.parse(localStorage.getItem('saiWaterjetConfig')) || defaultConfig;
    let quoteState = { mat: 1, thk: 1, type: '', qty: 0 };

    // --- INIT ---
    function init() {
        // Render Material Cards
        const matGrid = document.getElementById('materialGrid');
        matGrid.innerHTML = config.materials.map(m => `
            <div class="choice-card" onclick="nextStep(1, ${m.val}, '${m.name}')">
                <span class="icon">${m.icon}</span>
                <span class="label">${m.name}</span>
            </div>
        `).join('');

        // Render Thickness Cards
        const thkGrid = document.getElementById('thicknessGrid');
        thkGrid.innerHTML = config.thickness.map(t => `
            <div class="choice-card" onclick="nextStep(2, ${t.val}, '${t.name}')">
                <span class="label">${t.name}</span>
            </div>
        `).join('');
        
        updateProgress(1);
    }

    // --- NAVIGATION LOGIC ---
    let currentStepIndex = 1;
    
    function showStep(n) {
        document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
        document.getElementById('step'+n).classList.add('active');
        currentStepIndex = n;
        updateProgress(n);
    }

    function updateProgress(n) {
        const pct = (n / 5) * 100;
        document.getElementById('progressBar').style.width = pct + '%';
    }

    function changeStep(dir) {
        showStep(currentStepIndex + dir);
    }

    // --- WIZARD ACTIONS ---
    window.nextStep = (stepNum, val, name) => {
        if(stepNum === 1) { quoteState.mat = val; quoteState.matName = name; }
        if(stepNum === 2) { quoteState.thk = val; quoteState.thkName = name; }
        showStep(stepNum + 1);
    };

    window.selectType = (type) => {
        quoteState.type = type;
        
        const container = document.getElementById('input-container');
        const title = document.getElementById('dimTitle');
        
        if (type === 'linear') {
            title.innerText = "Linear Cut Details";
            container.innerHTML = `<label>Total Length (Meters)</label><input type="number" id="inputQty" placeholder="e.g. 10.5">`;
        } else if (type === 'cutout') {
            title.innerText = "Cut-out Details";
            container.innerHTML = `<label>Number of Holes</label><input type="number" id="inputQty" placeholder="e.g. 4">`;
        } else {
            title.innerText = "Artistic Details";
            container.innerHTML = `
                <label>Total Area (m¬≤)</label><input type="number" id="inputQty" placeholder="e.g. 2.5">
                <label>Complexity</label>
                <select id="complexityFactor" style="width:100%; padding:10px; font-size:1rem; border:2px solid #e2e8f0; border-radius:8px;">
                    <option value="1">Basic (Geometric)</option>
                    <option value="1.5">Mid (Text/Floral)</option>
                    <option value="2.5">High (Complex Logo)</option>
                </select>
            `;
        }
        showStep(4);
    };

    window.calculateFinal = () => {
        const qty = parseFloat(document.getElementById('inputQty').value) || 0;
        if(qty === 0) { alert("Please enter a quantity!"); return; }

        let basePrice = 0;
        let unitText = "";
        
        // Base Calculation
        if(quoteState.type === 'linear') {
            basePrice = qty * config.rates.linear;
            unitText = `${qty} meters`;
        } else if (quoteState.type === 'cutout') {
            basePrice = qty * config.rates.cutout;
            unitText = `${qty} cut-outs`;
        } else {
            const comp = parseFloat(document.getElementById('complexityFactor').value);
            basePrice = qty * config.rates.artistic * comp;
            unitText = `${qty} m¬≤ (Complexity x${comp})`;
        }

        // Apply Multipliers
        const matMult = quoteState.mat * quoteState.thk;
        const subtotal = basePrice * matMult;

        // Extras
        let extras = 0;
        const hasCadFee = document.getElementById('opt-cad').checked;
        const hasPolish = document.getElementById('opt-polish').checked;
        
        if(hasCadFee) extras += config.fees.drafting;
        if(hasPolish) {
            // Estimate polish cost (simplified)
            const polishUnit = quoteState.type === 'artistic' ? qty * 4 : qty; 
            extras += (polishUnit * config.fees.polish);
        }

        const total = subtotal + extras;

        // Render Result
        document.getElementById('priceDisplay').innerText = '$' + total.toFixed(2);
        document.getElementById('summaryText').innerHTML = `
            <div><span>Type:</span> <strong>${quoteState.type.toUpperCase()}</strong></div>
            <div><span>Volume:</span> <strong>${unitText}</strong></div>
            <div><span>Material:</span> <strong>${quoteState.matName} (x${quoteState.mat})</strong></div>
            <div><span>Thickness:</span> <strong>${quoteState.thkName} (x${quoteState.thk})</strong></div>
            <div><span>Base Cost:</span> <strong>$${subtotal.toFixed(2)}</strong></div>
            <div><span>Extras:</span> <strong>$${extras.toFixed(2)}</strong></div>
        `;

        showStep(5);
    };

    // --- ADMIN LOGIC ---
    window.toggleAdmin = () => {
        const m = document.getElementById('adminModal');
        const form = document.getElementById('adminForm');
        
        if (!m.classList.contains('open')) {
            // Load values
            form.innerHTML = `
                <div class="form-row"><label>Linear Rate ($/m)</label> <input type="number" id="adm-linear" value="${config.rates.linear}"></div>
                <div class="form-row"><label>Cutout Rate ($/ea)</label> <input type="number" id="adm-cutout" value="${config.rates.cutout}"></div>
                <div class="form-row"><label>Drafting Fee ($)</label> <input type="number" id="adm-draft" value="${config.fees.drafting}"></div>
            `;
            m.classList.add('open');
        } else {
            m.classList.remove('open');
        }
    };

    window.saveConfig = () => {
        config.rates.linear = parseFloat(document.getElementById('adm-linear').value);
        config.rates.cutout = parseFloat(document.getElementById('adm-cutout').value);
        config.fees.drafting = parseFloat(document.getElementById('adm-draft').value);
        
        localStorage.setItem('saiWaterjetConfig', JSON.stringify(config));
        toggleAdmin();
        init(); // Refresh UI
    };

    init();

</script>
</body>
</html>
