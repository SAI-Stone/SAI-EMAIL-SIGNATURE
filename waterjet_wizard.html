<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAI Stone Visual Quote</title>
    <style>
        :root {
            --primary: #005f73;
            --primary-light: #0a9396;
            --bg: #f8fafc;
            --surface: #ffffff;
            --text-main: #1e293b;
            --text-sub: #64748b;
            --border: #e2e8f0;
            --selected-bg: #f0fdfe;
            --selected-border: #005f73;
        }

        * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text-main); margin: 0; min-height: 100vh; display: flex; flex-direction: column; }

        /* HEADER */
        header { background: var(--surface); padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 20; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .brand { font-weight: 800; font-size: 1.2rem; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        .admin-trigger { background: none; border: 1px solid var(--border); padding: 6px 12px; border-radius: 6px; cursor: pointer; color: var(--text-sub); font-size: 0.85rem; }

        /* MAIN */
        main { flex: 1; max-width: 800px; margin: 0 auto; width: 100%; padding: 2rem 1rem; }

        /* PROGRESS */
        .progress-bar { display: flex; justify-content: space-between; margin-bottom: 2rem; position: relative; max-width: 400px; margin-left: auto; margin-right: auto; }
        .progress-bar::before { content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 3px; background: #e2e8f0; z-index: 0; transform: translateY(-50%); }
        .p-step { position: relative; z-index: 1; background: white; border: 2px solid #e2e8f0; color: var(--text-sub); width: 32px; height: 32px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 0.9rem; transition: 0.3s; }
        .p-step.active { background: var(--primary); border-color: var(--primary); color: white; transform: scale(1.1); }
        .p-step.completed { background: var(--primary-light); border-color: var(--primary-light); color: white; }

        /* STEPS */
        .step-content { display: none; animation: fadeIn 0.3s ease-out; }
        .step-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h1 { text-align: center; margin: 0 0 0.5rem 0; color: var(--text-main); font-size: 1.5rem; }
        p.subtitle { text-align: center; color: var(--text-sub); margin: 0 0 2rem 0; font-size: 0.95rem; }

        /* CARD GRIDS (The new UI core) */
        .grid-cards-large { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        .grid-cards-small { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-bottom: 1.5rem; }

        .card { 
            background: var(--surface); border: 2px solid var(--border); border-radius: 12px; 
            padding: 1.5rem 1rem; text-align: center; cursor: pointer; transition: 0.2s; position: relative;
            display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100px;
        }
        .card:hover { border-color: var(--primary-light); transform: translateY(-2px); }
        .card.selected { border-color: var(--selected-border); background: var(--selected-bg); box-shadow: 0 0 0 1px var(--selected-border); }
        .card.disabled { opacity: 0.5; cursor: not-allowed; background: #f1f5f9; border-color: #e2e8f0; }
        
        .card .icon { font-size: 2rem; margin-bottom: 0.5rem; display: block; }
        .card b { font-size: 1rem; color: var(--text-main); line-height: 1.2; display: block; }
        .card .note { font-size: 0.75rem; color: var(--text-sub); margin-top: 4px; display: block; }
        .card .tag { position: absolute; top: 8px; right: 8px; background: #e0f2fe; color: #0284c7; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; font-weight: 700; }

        /* FORM INPUTS */
        .input-box { background: var(--surface); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 1.5rem; }
        .input-row { margin-bottom: 1rem; }
        .input-row:last-child { margin-bottom: 0; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem; }
        input[type="number"] { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 1.1rem; }
        input:focus { outline: 2px solid var(--primary); border-color: transparent; }

        /* ALERTS */
        .alert { padding: 1rem; border-radius: 8px; margin: 1rem 0; font-size: 0.9rem; display: none; text-align: left; }
        .alert-error { background: #fef2f2; border: 1px solid #fee2e2; color: #991b1b; }
        
        /* BOTTOM NAV */
        .nav-btns { display: flex; justify-content: space-between; margin-top: 2rem; padding-top: 1rem; border-top: 1px dashed #e2e8f0; }
        .btn { padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; font-size: 1rem; transition: 0.2s; }
        .btn-back { background: transparent; color: var(--text-sub); border: 1px solid var(--border); }
        .btn-back:hover { background: #f1f5f9; color: var(--text-main); }
        .btn-next { background: var(--primary); color: white; }
        .btn-next:hover { background: var(--primary-light); box-shadow: 0 4px 6px -1px rgba(0, 95, 115, 0.3); }
        .btn-next:disabled { background: #cbd5e1; cursor: not-allowed; box-shadow: none; }

        /* RESULTS */
        .result-card { background: var(--surface); padding: 2.5rem 1.5rem; border-radius: 16px; text-align: center; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); border: 1px solid var(--border); }
        .price-display { font-size: 3rem; font-weight: 800; color: var(--primary); line-height: 1; margin: 10px 0; }
        .gst-badge { display: inline-block; background: #dcfce7; color: #166534; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; vertical-align: middle; }
        
        .summary-list { text-align: left; background: #f8fafc; border-radius: 8px; padding: 1rem; margin: 1.5rem 0; font-size: 0.9rem; color: #334155; }
        .summary-row { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .summary-row.highlight { font-weight: 700; color: var(--primary); border-top: 1px solid #e2e8f0; padding-top: 8px; margin-top: 8px; }

        .copy-btn { width: 100%; background: #1e293b; color: white; padding: 14px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .copy-btn:hover { background: #0f172a; }

        /* ADMIN MODAL */
        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index: 100; display: none; justify-content: center; align-items: flex-start; overflow-y: auto; padding: 2rem 0; }
        .modal-box { background: white; width: 90%; max-width: 600px; padding: 2rem; border-radius: 12px; }
        details { margin-bottom: 1rem; border: 1px solid var(--border); border-radius: 8px; }
        summary { padding: 1rem; cursor: pointer; font-weight: 600; background: #f8fafc; }
        .admin-row { display: flex; gap: 8px; margin-bottom: 8px; padding: 0 1rem; }
        .admin-row:last-child { margin-bottom: 1rem; }
        .admin-row input { padding: 6px; border: 1px solid #ccc; border-radius: 4px; }
        
        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 24px; border-radius: 30px; opacity: 0; transition: 0.3s; pointer-events: none; }
        #toast.show { opacity: 1; bottom: 40px; }
    </style>
</head>
<body>

<header>
    <div class="brand">üíé SAI Stone Quote</div>
    <button class="admin-trigger" onclick="openAdmin()">‚öôÔ∏è Admin</button>
</header>

<main>
    <div class="progress-bar">
        <div class="p-step active" id="p1">1</div>
        <div class="p-step" id="p2">2</div>
        <div class="p-step" id="p3">3</div>
        <div class="p-step" id="p4">$</div>
    </div>

    <div class="step-content active" id="step1">
        <h1>Select Product</h1>
        <p class="subtitle">Choose the type of fabrication</p>
        <div class="grid-cards-large">
            <div class="card" onclick="selectProduct('pool', this)">
                <span class="icon">üèä</span>
                <b>Pool Coping</b>
                <span class="note">Linear meters, Curves</span>
            </div>
            <div class="card" onclick="selectProduct('custom', this)">
                <span class="icon">üìê</span>
                <b>Custom Cut</b>
                <span class="note">Hearths, Benchtops</span>
            </div>
            <div class="card" onclick="selectProduct('artistic', this)">
                <span class="icon">üé®</span>
                <b>Artistic</b>
                <span class="note">Logos, Signage</span>
            </div>
        </div>
    </div>

    <div class="step-content" id="step2">
        <h1 id="detailsTitle">Dimensions & Edges</h1>
        <p class="subtitle">Enter size and choose edge profile</p>
        
        <div id="dynamicInputs"></div> <div id="edgeProfileContainer" style="display:none;">
            <label style="margin-bottom:10px;">Select Edge Profile</label>
            <div class="grid-cards-small" id="edgeGrid">
                </div>
        </div>

        <div class="alert alert-error" id="errorMsg"></div>

        <div class="nav-btns">
            <button class="btn btn-back" onclick="goToStep(1)">Back</button>
            <button class="btn btn-next" onclick="validateStep2()">Next</button>
        </div>
    </div>

    <div class="step-content" id="step3">
        <h1>Material & Thickness</h1>
        <p class="subtitle">Select the stone specifications</p>

        <label>1. Select Stone Type</label>
        <div class="grid-cards-small" id="materialGrid">
            </div>

        <label>2. Select Thickness</label>
        <div class="grid-cards-small" id="thicknessGrid">
            </div>

        <div class="nav-btns">
            <button class="btn btn-back" onclick="goToStep(2)">Back</button>
            <button class="btn btn-next" onclick="calculateQuote()">Calculate</button>
        </div>
    </div>

    <div class="step-content" id="step4">
        <div class="result-card">
            <span class="gst-badge">GST INCLUSIVE</span>
            <h3>Total Estimate</h3>
            <div class="price-display" id="finalPriceDisplay">$0.00</div>
            
            <div class="summary-list" id="breakdownDisplay"></div>

            <button class="copy-btn" onclick="copyToClipboard()">
                üìÑ Copy Summary
            </button>
        </div>
        <div class="nav-btns">
            <button class="btn btn-back" onclick="goToStep(3)">Edit</button>
            <button class="btn btn-next" onclick="location.reload()">Start New</button>
        </div>
    </div>
</main>

<div id="toast">Copied to Clipboard!</div>

<div class="modal-overlay" id="adminModal">
    <div class="modal-box">
        <h2>‚öôÔ∏è Configuration</h2>
        <div id="adminContent"></div>
        <div class="nav-btns">
            <button class="btn btn-back" onclick="closeAdmin()">Cancel</button>
            <button class="btn btn-next" onclick="saveAdminConfig()">Save</button>
        </div>
    </div>
</div>

<script>
    // --- 1. CONFIG & STATE ---
    const defaultConfig = {
        minCharge: 165,
        materials: [
            { name: "Limestone (Soft)", val: 1.0 },
            { name: "Granite (Hard)", val: 1.3 },
            { name: "Quartzite (Ultra)", val: 1.6 }
        ],
        thicknesses: [
            { name: "20mm", val: 1.0 },
            { name: "30-40mm", val: 1.5 },
            { name: "50mm+", val: 2.0 }
        ],
        rates: { pool: 49.5, custom: 330, hole: 66, artistic: 495 },
        fees: { template: 605, pencil: 16.5, bullnose: 49.5, honed: 27.5 }
    };

    let config = JSON.parse(localStorage.getItem('saiStoneConfigV4')) || defaultConfig;
    
    // Global State
    let state = {
        product: '',
        details: {}, // stores lengths, areas
        edgeProfile: 'none', // for pool
        materialIndex: 0,
        thicknessIndex: 0
    };

    // --- 2. INIT & RENDERERS ---
    function init() {
        renderMaterials();
        renderThicknesses();
    }

    function renderMaterials() {
        const grid = document.getElementById('materialGrid');
        grid.innerHTML = config.materials.map((m, i) => `
            <div class="card ${state.materialIndex === i ? 'selected' : ''}" onclick="selectMaterial(${i})">
                <b>${m.name}</b>
                <span class="note">Factor: x${m.val}</span>
            </div>
        `).join('');
    }

    function renderThicknesses() {
        const grid = document.getElementById('thicknessGrid');
        grid.innerHTML = config.thicknesses.map((t, i) => `
            <div class="card ${state.thicknessIndex === i ? 'selected' : ''}" onclick="selectThickness(${i})">
                <b>${t.name}</b>
                <span class="note">Factor: x${t.val}</span>
            </div>
        `).join('');
    }

    // --- 3. INTERACTION HANDLERS ---
    window.selectMaterial = (i) => {
        state.materialIndex = i;
        renderMaterials(); // Re-render to update selection style
    }

    window.selectThickness = (i) => {
        state.thicknessIndex = i;
        renderThicknesses(); // Re-render
    }

    window.selectEdge = (type) => {
        if(type === 'dropface') {
            alert("‚ö†Ô∏è We cannot produce Dropface locally.");
            return;
        }
        state.edgeProfile = type;
        // Re-render edge grid to show selection
        renderEdgeGrid(); 
    }

    function renderEdgeGrid() {
        const grid = document.getElementById('edgeGrid');
        const options = [
            { id: 'none', name: 'Sawn/Straight', icon: 'üìè', price: 0 },
            { id: 'pencil', name: 'Pencil Round', icon: '‚úèÔ∏è', price: config.fees.pencil },
            { id: 'bullnose', name: 'Bullnose', icon: '‚≠ï', price: config.fees.bullnose },
            { id: 'dropface', name: 'Dropface', icon: 'üö´', price: 0, disabled: true }
        ];

        grid.innerHTML = options.map(opt => `
            <div class="card ${state.edgeProfile === opt.id ? 'selected' : ''} ${opt.disabled ? 'disabled' : ''}" 
                 onclick="selectEdge('${opt.id}')">
                <span class="icon">${opt.icon}</span>
                <b>${opt.name}</b>
                ${opt.price > 0 ? `<span class="tag">+$${opt.price}</span>` : ''}
            </div>
        `).join('');
    }

    window.selectProduct = (type, el) => {
        state.product = type;
        document.querySelectorAll('#step1 .card').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        
        // Setup Step 2 UI based on product
        setupStep2(type);
        setTimeout(() => goToStep(2), 200);
    }

    function setupStep2(type) {
        const inputs = document.getElementById('dynamicInputs');
        const edgeContainer = document.getElementById('edgeProfileContainer');
        
        let html = '';
        state.edgeProfile = 'none'; // Reset edge

        if(type === 'pool') {
            inputs.innerHTML = `
                <div class="input-box">
                    <label>Total Length (Linear Meters)</label>
                    <input type="number" id="inp_len" placeholder="e.g. 15.5">
                    
                    <label style="margin-top:15px; display:flex; align-items:center; gap:10px;">
                        <input type="checkbox" id="inp_temp" style="width:auto;"> Include Templating? (+$${config.fees.template})
                    </label>
                </div>
            `;
            edgeContainer.style.display = 'block';
            renderEdgeGrid();
        } else if (type === 'custom') {
            inputs.innerHTML = `
                <div class="input-box">
                    <div class="input-row"><label>Length (mm)</label><input type="number" id="inp_l"></div>
                    <div class="input-row"><label>Width (mm)</label><input type="number" id="inp_w"></div>
                </div>
                <div class="input-box">
                    <div class="input-row"><label>Cut-outs (Qty)</label><input type="number" id="inp_holes" value="0"></div>
                    <div class="input-row">
                        <label>Polished Edge (mm)</label>
                        <input type="number" id="inp_polish" value="0">
                        <span style="font-size:0.8rem; color:#666">Total length to hone/polish</span>
                    </div>
                </div>
            `;
            edgeContainer.style.display = 'none';
        } else {
            inputs.innerHTML = `
                <div class="input-box">
                    <label>Total Area (m¬≤)</label>
                    <input type="number" id="inp_area" placeholder="e.g. 1.2">
                    <label style="margin-top:15px">Complexity</label>
                    <select id="inp_complex" style="width:100%; padding:10px; border:1px solid #e2e8f0; border-radius:8px;">
                        <option value="1">Basic</option>
                        <option value="1.5">Medium</option>
                        <option value="2.5">High</option>
                    </select>
                </div>
            `;
            edgeContainer.style.display = 'none';
        }
    }

    // --- 4. NAVIGATION & VALIDATION ---
    function goToStep(n) {
        document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
        document.getElementById(`step${n}`).classList.add('active');
        
        for(let i=1; i<=4; i++) {
            const dot = document.getElementById(`p${i}`);
            dot.classList.remove('active', 'completed');
            if(i === n) dot.classList.add('active');
            if(i < n) dot.classList.add('completed');
        }
        document.getElementById('errorMsg').style.display = 'none';
    }

    window.validateStep2 = () => {
        let valid = true;
        if(state.product === 'pool') {
            const len = parseFloat(document.getElementById('inp_len').value);
            if(!len || len <= 0) valid = false;
        } else if (state.product === 'custom') {
            if(!document.getElementById('inp_l').value || !document.getElementById('inp_w').value) valid = false;
        } else {
            if(!document.getElementById('inp_area').value) valid = false;
        }

        if(!valid) {
            const err = document.getElementById('errorMsg');
            err.innerText = "Please check all dimensions.";
            err.style.display = 'block';
        } else {
            goToStep(3);
        }
    }

    // --- 5. CALCULATOR ---
    window.calculateQuote = () => {
        const material = config.materials[state.materialIndex];
        const thickness = config.thicknesses[state.thicknessIndex];
        const multiplier = material.val * thickness.val;

        let total = 0;
        let summaryLines = [];
        let clipboardText = `QUOTE (GST INC)\nMaterial: ${material.name} ${thickness.name}\n`;

        if(state.product === 'pool') {
            const len = parseFloat(document.getElementById('inp_len').value);
            const hasTemp = document.getElementById('inp_temp').checked;
            
            // Calculate Unit Rate
            let edgeCost = 0;
            if(state.edgeProfile === 'pencil') edgeCost = config.fees.pencil;
            if(state.edgeProfile === 'bullnose') edgeCost = config.fees.bullnose;

            let unitRate = (config.rates.pool + edgeCost) * multiplier;
            let subtotal = unitRate * len;
            let tempFee = hasTemp ? config.fees.template : 0;
            
            total = subtotal + tempFee;

            summaryLines.push(`<span class="summary-row"><span>Run Length</span> <span>${len} lm</span></span>`);
            summaryLines.push(`<span class="summary-row"><span>Edge Profile</span> <span>${state.edgeProfile.toUpperCase()}</span></span>`);
            summaryLines.push(`<span class="summary-row highlight"><span>UNIT RATE</span> <span>$${unitRate.toFixed(2)} / lm</span></span>`);
            if(hasTemp) summaryLines.push(`<span class="summary-row"><span>Templating</span> <span>$${tempFee}</span></span>`);
            
            clipboardText += `Product: Pool Coping\nLength: ${len}lm\nProfile: ${state.edgeProfile}\nUnit Rate: $${unitRate.toFixed(2)}/lm\nTemplating: ${hasTemp ? 'Yes' : 'No'}\n`;

        } else if (state.product === 'custom') {
            const l = document.getElementById('inp_l').value / 1000;
            const w = document.getElementById('inp_w').value / 1000;
            const holes = document.getElementById('inp_holes').value || 0;
            const polish = document.getElementById('inp_polish').value / 1000;
            const area = l * w;

            let processing = (area * config.rates.custom) + (holes * config.rates.hole);
            let materialCost = processing * multiplier;
            let polishCost = (polish * config.fees.honed) * multiplier; // Polish affected by stone hardness usually, simplifying here

            total = materialCost + polishCost;

            summaryLines.push(`<span class="summary-row"><span>Area</span> <span>${area.toFixed(2)} m¬≤</span></span>`);
            summaryLines.push(`<span class="summary-row"><span>Cut-outs</span> <span>${holes}</span></span>`);
            summaryLines.push(`<span class="summary-row"><span>Polishing</span> <span>${polish} lm</span></span>`);
            
            clipboardText += `Product: Custom Cut\nSize: ${(l*1000).toFixed(0)}x${(w*1000).toFixed(0)}mm\nHoles: ${holes}\nPolish: ${polish}m\n`;

        } else {
            const area = document.getElementById('inp_area').value;
            const comp = document.getElementById('inp_complex').value;
            total = (area * config.rates.artistic * comp) * multiplier;
            
            summaryLines.push(`<span class="summary-row"><span>Area</span> <span>${area} m¬≤</span></span>`);
            summaryLines.push(`<span class="summary-row"><span>Complexity</span> <span>x${comp}</span></span>`);
            clipboardText += `Product: Artistic\nArea: ${area}m2\nComplexity: ${comp}\n`;
        }

        // Min Charge
        if(total < config.minCharge) {
            total = config.minCharge;
            summaryLines.push(`<div style="color:red; font-size:0.8rem; margin-top:5px;">(Min Charge Applied)</div>`);
            clipboardText += `(Minimum Charge Applied)\n`;
        }

        clipboardText += `----------------\nTOTAL: $${total.toFixed(2)}`;
        
        document.getElementById('finalPriceDisplay').innerText = '$' + total.toFixed(2);
        document.getElementById('breakdownDisplay').innerHTML = summaryLines.join('');
        document.querySelector('.copy-btn').setAttribute('data-text', clipboardText);

        goToStep(4);
    }

    window.copyToClipboard = () => {
        const text = document.querySelector('.copy-btn').getAttribute('data-text');
        navigator.clipboard.writeText(text).then(() => {
            document.getElementById('toast').classList.add('show');
            setTimeout(() => document.getElementById('toast').classList.remove('show'), 2000);
        });
    }

    // --- 6. ADMIN ---
    window.openAdmin = () => {
        const c = config;
        document.getElementById('adminContent').innerHTML = `
            <details open><summary>Materials</summary>
                ${c.materials.map((m,i)=>`<div class="admin-row"><input value="${m.name}" onchange="upd('materials',${i},'name',this.value)"><input type="number" value="${m.val}" step="0.1" onchange="upd('materials',${i},'val',this.value)"></div>`).join('')}
                <button onclick="add('materials')" style="width:100%; padding:8px; margin-top:5px;">+ Add Material</button>
            </details>
            <details><summary>Thicknesses</summary>
                ${c.thicknesses.map((t,i)=>`<div class="admin-row"><input value="${t.name}" onchange="upd('thicknesses',${i},'name',this.value)"><input type="number" value="${t.val}" step="0.1" onchange="upd('thicknesses',${i},'val',this.value)"></div>`).join('')}
                <button onclick="add('thicknesses')" style="width:100%; padding:8px; margin-top:5px;">+ Add Thickness</button>
            </details>
            <details><summary>Rates ($)</summary>
                <div class="admin-row"><label>Pool/lm:</label><input type="number" id="adm_pool" value="${c.rates.pool}"></div>
                <div class="admin-row"><label>Custom/m2:</label><input type="number" id="adm_cust" value="${c.rates.custom}"></div>
                <div class="admin-row"><label>Template:</label><input type="number" id="adm_temp" value="${c.fees.template}"></div>
                <div class="admin-row"><label>Min Charge:</label><input type="number" id="adm_min" value="${c.minCharge}"></div>
            </details>
        `;
        document.getElementById('adminModal').style.display = 'flex';
    }

    window.closeAdmin = () => document.getElementById('adminModal').style.display = 'none';

    window.upd = (arr, i, key, val) => config[arr][i][key] = (key==='val'?parseFloat(val):val);
    window.add = (arr) => { config[arr].push({name:'New', val:1.0}); openAdmin(); };
    
    window.saveAdminConfig = () => {
        config.rates.pool = parseFloat(document.getElementById('adm_pool').value);
        config.rates.custom = parseFloat(document.getElementById('adm_cust').value);
        config.fees.template = parseFloat(document.getElementById('adm_temp').value);
        config.minCharge = parseFloat(document.getElementById('adm_min').value);
        
        localStorage.setItem('saiStoneConfigV4', JSON.stringify(config));
        closeAdmin();
        init(); // Refresh grids
    }

    init();
</script>
</body>
</html>
