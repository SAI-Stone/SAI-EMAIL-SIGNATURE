<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAI Stone Pro Quote V6</title>
    <style>
        :root {
            --primary: #005f73;
            --primary-dark: #003f4d;
            --secondary: #94a3b8;
            --bg: #f8fafc;
            --surface: #ffffff;
            --text-main: #0f172a;
            --border: #e2e8f0;
            --highlight: #e0f2fe;
            --warning-bg: #fff7ed;
            --warning-text: #9a3412;
        }

        * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        body { background: var(--bg); color: var(--text-main); margin: 0; min-height: 100vh; display: flex; flex-direction: column; }

        /* HEADER */
        header { background: var(--surface); padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .brand { font-weight: 800; font-size: 1.25rem; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        .admin-trigger { background: none; border: 1px solid var(--border); padding: 6px 12px; border-radius: 6px; cursor: pointer; color: var(--secondary); font-size: 0.85rem; }

        /* MAIN */
        main { flex: 1; max-width: 900px; margin: 0 auto; width: 100%; padding: 2rem 1rem; }

        /* PROGRESS */
        .progress-container { max-width: 500px; margin: 0 auto 2.5rem auto; position: relative; }
        .progress-line { position: absolute; top: 50%; left: 0; width: 100%; height: 3px; background: #e2e8f0; z-index: 0; transform: translateY(-50%); }
        .progress-steps { display: flex; justify-content: space-between; position: relative; z-index: 1; }
        .step-dot { background: white; border: 2px solid #e2e8f0; color: #94a3b8; width: 36px; height: 36px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: 700; font-size: 0.9rem; transition: 0.3s; }
        .step-dot.active { border-color: var(--primary); background: var(--primary); color: white; transform: scale(1.15); box-shadow: 0 0 0 4px rgba(0,95,115,0.2); }
        .step-dot.done { background: var(--primary); border-color: var(--primary); color: white; }

        /* STEPS */
        .step-content { display: none; animation: slideUp 0.3s ease-out; }
        .step-content.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* CARDS */
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; }
        .grid-material { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1rem; }
        .grid-mini { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-bottom: 1rem; }

        .card { 
            background: var(--surface); border: 2px solid var(--border); border-radius: 12px; 
            padding: 1.2rem; text-align: center; cursor: pointer; transition: 0.2s; position: relative;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .card:hover { border-color: var(--primary); transform: translateY(-2px); }
        .card.selected { border-color: var(--primary); background: var(--highlight); box-shadow: 0 0 0 2px var(--primary); }
        .card.disabled { opacity: 0.6; cursor: not-allowed; background: #f1f5f9; border-color: #e2e8f0; }
        
        .card .icon { font-size: 1.8rem; margin-bottom: 0.5rem; }
        .card b { font-size: 1rem; display: block; color: var(--text-main); }
        .card .tags { font-size: 0.75rem; color: #64748b; line-height: 1.3; margin-top: 4px; }
        .card .price-tag { font-size: 0.75rem; color: var(--primary); font-weight: 700; margin-top: 4px; background: #ccfbf1; padding: 2px 6px; border-radius: 4px; }

        /* SECTIONS */
        .section-label { font-size: 0.9rem; font-weight: 700; color: #334155; margin-bottom: 8px; display: block; }
        .input-group { background: white; padding: 1.5rem; border: 1px solid var(--border); border-radius: 12px; margin-bottom: 1.5rem; }
        
        input[type="number"] { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 1rem; }
        
        /* WARNING BOX */
        .warning-box { background: var(--warning-bg); border: 1px solid #ffedd5; color: var(--warning-text); padding: 1rem; border-radius: 8px; font-size: 0.9rem; margin-top: 1rem; display: flex; align-items: start; gap: 10px; }

        /* SEARCH */
        .search-input { width: 100%; padding: 12px 16px; border-radius: 30px; border: 1px solid #cbd5e1; font-size: 1rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        /* NAV & RESULTS */
        .nav-btns { display: flex; justify-content: space-between; margin-top: 2rem; border-top: 1px dashed #e2e8f0; padding-top: 1.5rem; }
        .btn { padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; font-size: 1rem; }
        .btn-back { background: white; border: 1px solid #cbd5e1; color: #475569; }
        .btn-next { background: var(--primary); color: white; }
        .btn-next:disabled { background: #cbd5e1; cursor: not-allowed; }

        .result-box { background: white; padding: 3rem 1rem; border-radius: 16px; text-align: center; border: 1px solid #e2e8f0; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); }
        .price-display { font-size: 3.5rem; font-weight: 800; color: var(--primary); margin: 10px 0; line-height: 1; }
        .summary-table { width: 100%; max-width: 500px; margin: 2rem auto; border-collapse: collapse; text-align: left; font-size: 0.95rem; }
        .summary-table td { padding: 8px 0; border-bottom: 1px solid #f1f5f9; }
        .summary-table .highlight { color: var(--primary); font-weight: 700; }
        .copy-btn { background: #1e293b; color: white; padding: 14px; border-radius: 8px; cursor: pointer; width: 100%; max-width: 300px; margin: 0 auto; display: block; font-weight: 600; border: none; }

        /* ADMIN */
        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index: 100; display: none; justify-content: center; align-items: flex-start; overflow-y: auto; padding: 2rem 0; }
        .modal-content { background: white; width: 90%; max-width: 500px; padding: 2rem; border-radius: 12px; }
        .admin-row { display: flex; justify-content: space-between; margin-bottom: 8px; align-items: center; }
        .admin-row input { width: 80px; text-align: right; }
    </style>
</head>
<body>

<header>
    <div class="brand">üíé SAI Stone Quote</div>
    <button class="admin-trigger" onclick="toggleAdmin()">‚öôÔ∏è Admin</button>
</header>

<main>
    <div class="progress-container">
        <div class="progress-line"></div>
        <div class="progress-steps">
            <div class="step-dot active" id="dot1">1</div>
            <div class="step-dot" id="dot2">2</div>
            <div class="step-dot" id="dot3">3</div>
            <div class="step-dot" id="dot4">$</div>
        </div>
    </div>

    <div class="step-content active" id="step1">
        <h1 style="text-align:center; margin-bottom:0.5rem">Select Product</h1>
        <p class="subtitle">What are we fabricating?</p>
        <div class="grid-3">
            <div class="card" onclick="setProduct('pool', this)">
                <span class="icon">üèä</span>
                <b>Pool Coping</b>
                <span class="tags">Curved / Linear Runs</span>
            </div>
            <div class="card" onclick="setProduct('custom', this)">
                <span class="icon">üìê</span>
                <b>Custom Cut</b>
                <span class="tags">Hearths / Benchtops</span>
            </div>
            <div class="card" onclick="setProduct('artistic', this)">
                <span class="icon">üé®</span>
                <b>Artistic</b>
                <span class="tags">Logos / Inlay</span>
            </div>
        </div>
    </div>

    <div class="step-content" id="step2">
        <h1 style="text-align:center; margin-bottom:0.5rem">Details & Edge</h1>
        <p class="subtitle">Dimensions and Edge Treatment</p>
        
        <div id="dynamicInputs" class="input-group"></div>

        <div id="poolOptions" style="display:none;">
            
            <span class="section-label">1. Edge Profile (Shape)</span>
            <div class="grid-mini" id="edgeProfileGrid"></div>

            <span class="section-label">2. Edge Finish (Texture)</span>
            <div class="grid-mini" id="edgeFinishGrid"></div>
            
            <div class="warning-box">
                <span style="font-size:1.2rem">‚ö†Ô∏è</span>
                <div>
                    <strong>Client Notice:</strong> We can only produce <strong>Sawn</strong> or <strong>Honed</strong> edges.<br>
                    Flamed, Sandblasted, or Tumbled finishes <u>cannot</u> be applied to the cut edge.
                </div>
            </div>
        </div>

        <div class="alert alert-error" id="errorMsg" style="display:none; color:red; margin-top:10px;">Please check dimensions.</div>

        <div class="nav-btns">
            <button class="btn btn-back" onclick="navTo(1)">Back</button>
            <button class="btn btn-next" onclick="validateStep2()">Next</button>
        </div>
    </div>

    <div class="step-content" id="step3">
        <h1 style="text-align:center; margin-bottom:0.5rem">Material</h1>
        <p class="subtitle">Select Stone & Thickness</p>

        <input type="text" class="search-input" placeholder="üîç Search stone name (e.g. Zen, Blueocean)..." onkeyup="filterMat(this.value)">

        <div class="grid-material" id="materialGrid"></div>

        <span class="section-label" style="margin-top:2rem">Thickness</span>
        <div class="grid-mini" id="thicknessGrid"></div>

        <div class="nav-btns">
            <button class="btn btn-back" onclick="navTo(2)">Back</button>
            <button class="btn btn-next" onclick="calculate()">Calculate Price</button>
        </div>
    </div>

    <div class="step-content" id="step4">
        <div class="result-box">
            <span style="background:#dcfce7; color:#166534; padding:4px 10px; border-radius:20px; font-weight:800; font-size:0.75rem;">GST INCLUSIVE</span>
            <h3>Total Estimate</h3>
            <div class="price-display" id="finalPrice">$0.00</div>
            <table class="summary-table" id="summaryTable"></table>
            <button class="copy-btn" onclick="copyQuote()">üìÑ Copy Summary</button>
        </div>
        <div class="nav-btns">
            <button class="btn btn-back" onclick="navTo(3)">Edit</button>
            <button class="btn btn-next" onclick="location.reload()">Start New</button>
        </div>
    </div>
</main>

<div class="modal-overlay" id="adminModal">
    <div class="modal-content">
        <h2>‚öôÔ∏è Admin Config (GST Inc)</h2>
        <div id="adminForm"></div>
        <div class="nav-btns">
            <button class="btn btn-back" onclick="toggleAdmin()">Cancel</button>
            <button class="btn btn-next" onclick="saveConfig()">Save</button>
        </div>
    </div>
</div>

<script>
    // --- 1. CONFIGURATION ---
    const defaultConfig = {
        minCharge: 165,
        materials: [
            { category: "Limestone / Travertine", val: 1.0, tags: "Galala, Lime Greige, Sunny Menia, Belgium Blue, Moonlight Grey" },
            { category: "Bluestone (Basalt)", val: 1.3, tags: "Steel Blue, Blueocean, Antline, Lux Black, Stormy Grey" },
            { category: "Granite / Marble", val: 1.3, tags: "Zen Grey, Ken Black, Ash Grey, Sesame White, Black Pearl, Frozen Blue" },
            { category: "Porcelain / Porphyry", val: 1.6, tags: "Porcelain Tiles, QLD Porphyry" }
        ],
        thickness: [
            { name: "20mm", val: 1.0 },
            { name: "30-40mm", val: 1.5 },
            { name: "50mm+", val: 2.0 }
        ],
        rates: { pool: 49.5, custom: 330, hole: 66, artistic: 495 },
        fees: { template: 605, pencil: 16.5, bullnose: 49.5, honed: 27.5 }
    };

    let config = JSON.parse(localStorage.getItem('saiStoneConfigV6')) || defaultConfig;

    // State
    let state = {
        product: '',
        edgeProfile: 'none',
        edgeFinish: 'sawn',
        matIdx: 0,
        thkIdx: 0
    };

    // --- 2. RENDERERS ---
    function init() {
        renderMaterials();
        renderThickness();
        renderEdgeOptions();
    }

    function renderMaterials() {
        document.getElementById('materialGrid').innerHTML = config.materials.map((m, i) => `
            <div class="card mat-card ${state.matIdx===i?'selected':''}" onclick="setMat(${i})">
                <b>${m.category}</b>
                <span class="tags">${m.tags}</span>
            </div>
        `).join('');
    }

    function renderThickness() {
        document.getElementById('thicknessGrid').innerHTML = config.thickness.map((t, i) => `
            <div class="card ${state.thkIdx===i?'selected':''}" onclick="setThk(${i})">
                <b>${t.name}</b>
            </div>
        `).join('');
    }

    function renderEdgeOptions() {
        // Profiles
        const profiles = [
            { id: 'none', name: 'Sawn / Straight', icon: 'üìè', price: 0 },
            { id: 'pencil', name: 'Pencil Round', icon: '‚úèÔ∏è', price: config.fees.pencil },
            { id: 'bullnose', name: 'Bullnose', icon: '‚≠ï', price: config.fees.bullnose },
            { id: 'dropface', name: 'Dropface', icon: 'üö´', disabled: true }
        ];
        document.getElementById('edgeProfileGrid').innerHTML = profiles.map(p => `
            <div class="card ${state.edgeProfile===p.id?'selected':''} ${p.disabled?'disabled':''}" onclick="setProfile('${p.id}')">
                <span class="icon">${p.icon}</span>
                <b>${p.name}</b>
                ${p.price>0 ? `<span class="price-tag">+$${p.price}</span>`:''}
            </div>
        `).join('');

        // Finishes
        const finishes = [
            { id: 'sawn', name: 'Sawn (Standard)', icon: 'üå´Ô∏è', price: 0 },
            { id: 'honed', name: 'Honed (Polished)', icon: '‚ú®', price: config.fees.honed }
        ];
        document.getElementById('edgeFinishGrid').innerHTML = finishes.map(f => `
            <div class="card ${state.edgeFinish===f.id?'selected':''}" onclick="setFinish('${f.id}')">
                <span class="icon">${f.icon}</span>
                <b>${f.name}</b>
                ${f.price>0 ? `<span class="price-tag">+$${f.price}</span>`:''}
            </div>
        `).join('');
    }

    // --- 3. LOGIC & NAV ---
    function setProduct(type, el) {
        state.product = type;
        document.querySelectorAll('#step1 .card').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        
        const div = document.getElementById('dynamicInputs');
        const poolOpts = document.getElementById('poolOptions');

        if(type === 'pool') {
            div.innerHTML = `
                <div class="input-group">
                    <label>Total Length (Linear Meters)</label>
                    <input type="number" id="inp_len" placeholder="e.g. 12.5">
                    <label style="margin-top:15px; display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" id="inp_temp"> Include Templating? (+$${config.fees.template})
                    </label>
                </div>`;
            poolOpts.style.display = 'block';
        } else if(type === 'custom') {
            div.innerHTML = `
                <div class="input-group">
                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <div><label>Length (mm)</label><input type="number" id="inp_l"></div>
                        <div><label>Width (mm)</label><input type="number" id="inp_w"></div>
                    </div>
                    <label>Internal Cut-outs (Qty)</label><input type="number" id="inp_holes" value="0">
                    <label style="margin-top:10px;">Honed/Polished Edge Length (mm)</label>
                    <input type="number" id="inp_polish" value="0">
                    <span style="font-size:0.8rem; color:#64748b">Only enter the length that needs polishing. Default is Sawn.</span>
                </div>`;
            poolOpts.style.display = 'none';
        } else {
            div.innerHTML = `
                <div class="input-group">
                    <label>Area (m¬≤)</label><input type="number" id="inp_area">
                    <label style="margin-top:10px">Complexity</label>
                    <select id="inp_comp"><option value="1">Basic</option><option value="1.5">Medium</option><option value="2.5">High</option></select>
                </div>`;
            poolOpts.style.display = 'none';
        }
        setTimeout(()=>navTo(2), 200);
    }

    function setMat(i) { state.matIdx = i; renderMaterials(); }
    function setThk(i) { state.thkIdx = i; renderThickness(); }
    function setProfile(id) { 
        if(id==='dropface') return alert('Dropface unavailable.');
        state.edgeProfile = id; renderEdgeOptions(); 
    }
    function setFinish(id) { state.edgeFinish = id; renderEdgeOptions(); }
    
    function filterMat(txt) {
        document.querySelectorAll('.mat-card').forEach(c => {
            c.style.display = c.innerText.toLowerCase().includes(txt.toLowerCase()) ? 'flex':'none';
        });
    }

    function navTo(n) {
        document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
        document.getElementById(`step${n}`).classList.add('active');
        for(let i=1;i<=4;i++) {
            const d = document.getElementById(`dot${i}`);
            d.classList.remove('active','done');
            if(i===n) d.classList.add('active');
            if(i<n) d.classList.add('done');
        }
    }

    function validateStep2() {
        let valid = true;
        if(state.product==='pool' && !document.getElementById('inp_len').value) valid = false;
        if(state.product==='custom' && (!document.getElementById('inp_l').value || !document.getElementById('inp_w').value)) valid = false;
        if(state.product==='artistic' && !document.getElementById('inp_area').value) valid = false;
        
        document.getElementById('errorMsg').style.display = valid ? 'none':'block';
        if(valid) navTo(3);
    }

    function calculate() {
        const mat = config.materials[state.matIdx];
        const thk = config.thickness[state.thkIdx];
        const factor = mat.val * thk.val;
        
        let total = 0, rows = '', clip = `QUOTE (GST INC)\nMaterial: ${mat.category} ${thk.name}\n`;

        if(state.product === 'pool') {
            const len = parseFloat(document.getElementById('inp_len').value);
            const hasTemp = document.getElementById('inp_temp').checked;
            
            let extra = 0;
            if(state.edgeProfile === 'pencil') extra += config.fees.pencil;
            if(state.edgeProfile === 'bullnose') extra += config.fees.bullnose;
            if(state.edgeFinish === 'honed') extra += config.fees.honed; // Add finish cost

            let unitRate = (config.rates.pool + extra) * factor;
            let sub = unitRate * len;
            let temp = hasTemp ? config.fees.template : 0;
            total = sub + temp;

            rows += `<tr><td>Length</td><td>${len} lm</td></tr>`;
            rows += `<tr><td>Profile</td><td>${state.edgeProfile} + ${state.edgeFinish}</td></tr>`;
            rows += `<tr><td class="highlight">UNIT RATE</td><td class="highlight">$${unitRate.toFixed(2)}/lm</td></tr>`;
            if(hasTemp) rows += `<tr><td>Templating</td><td>$${temp}</td></tr>`;
            
            clip += `Pool Coping (${len}lm)\nEdge: ${state.edgeProfile}, ${state.edgeFinish}\nUnit Rate: $${unitRate.toFixed(2)}/lm\nTemplate: ${hasTemp?'Yes':'No'}`;

        } else if(state.product === 'custom') {
            const l = document.getElementById('inp_l').value/1000;
            const w = document.getElementById('inp_w').value/1000;
            const holes = document.getElementById('inp_holes').value;
            const polishLen = document.getElementById('inp_polish').value/1000;
            const area = l*w;
            
            let base = (area * config.rates.custom) + (holes * config.rates.hole);
            let matCost = base * factor;
            // Polish cost usually affected by Material Factor too
            let polishCost = (polishLen * config.fees.honed) * factor; 

            total = matCost + polishCost;

            rows += `<tr><td>Size</td><td>${(l*1000).toFixed(0)}x${(w*1000).toFixed(0)}mm</td></tr>`;
            rows += `<tr><td>Cut-outs</td><td>${holes}</td></tr>`;
            rows += `<tr><td>Honed Edge</td><td>${polishLen} m</td></tr>`;
            clip += `Custom ${(l*1000).toFixed(0)}x${(w*1000).toFixed(0)}mm\nHoles: ${holes}\nHoned Edge: ${polishLen}m`;

        } else {
            const area = document.getElementById('inp_area').value;
            const c = document.getElementById('inp_comp').value;
            total = (area * config.rates.artistic * c) * factor;
            rows += `<tr><td>Area</td><td>${area} m¬≤</td></tr><tr><td>Comp</td><td>x${c}</td></tr>`;
            clip += `Artistic ${area}m2 (x${c})`;
        }

        if(total < config.minCharge) {
            total = config.minCharge;
            rows += `<tr><td colspan="2" style="color:red;text-align:center">(Min Charge Applied)</td></tr>`;
            clip += `\n(Min Charge Applied)`;
        }
        
        rows += `<tr><td>TOTAL</td><td>$${total.toFixed(2)}</td></tr>`;
        clip += `\n--------------\nTOTAL: $${total.toFixed(2)}`;

        document.getElementById('finalPrice').innerText = '$'+total.toFixed(2);
        document.getElementById('summaryTable').innerHTML = rows;
        document.querySelector('.copy-btn').setAttribute('data-text', clip);
        navTo(4);
    }

    function copyQuote() {
        navigator.clipboard.writeText(document.querySelector('.copy-btn').getAttribute('data-text')).then(()=>alert('Copied!'));
    }

    function toggleAdmin() {
        const m = document.getElementById('adminModal');
        if(m.style.display==='flex') { m.style.display='none'; return; }
        
        const c = config;
        document.getElementById('adminForm').innerHTML = `
            <div style="background:#f1f5f9; padding:10px; border-radius:8px; margin-bottom:10px">
                <b>Rates (GST Inc)</b>
                <div class="admin-row"><label>Pool/lm</label><input id="adm_pool" value="${c.rates.pool}"></div>
                <div class="admin-row"><label>Honed/m</label><input id="adm_honed" value="${c.fees.honed}"></div>
                <div class="admin-row"><label>Template</label><input id="adm_temp" value="${c.fees.template}"></div>
            </div>
             <div style="background:#f1f5f9; padding:10px; border-radius:8px; margin-bottom:10px">
                <b>Material Multipliers</b>
                ${c.materials.map((m,i)=>`<div class="admin-row" style="font-size:0.8rem"><label style="flex:2">${m.category}</label><input id="mat_${i}" value="${m.val}"></div>`).join('')}
            </div>
        `;
        m.style.display='flex';
    }

    function saveConfig() {
        config.rates.pool = parseFloat(document.getElementById('adm_pool').value);
        config.fees.honed = parseFloat(document.getElementById('adm_honed').value);
        config.fees.template = parseFloat(document.getElementById('adm_temp').value);
        config.materials.forEach((m,i)=> m.val = parseFloat(document.getElementById(`mat_${i}`).value));
        
        localStorage.setItem('saiStoneConfigV6', JSON.stringify(config));
        toggleAdmin(); init();
    }

    init();
</script>
</body>
</html>
